# Упражнение 6. Ассемблер

Общее ограничение: В решениях - для повышения сложности и лучшего понимания програмирования на ассемблере в целом - запрещено использовать регистры `r9-r15`, хотя они и доступны в 64-битных процессорах x86-64. Т.е. можно использовать только `rax, rbx, rcx, rdx, rdi, rsi` и их подрегистры, вроде `eax`, `bl`, `ch` и т.д.

При разработке решений нужно иметь в виду, что инструкция системного вызова `syscall` имеет право менять регистры `rcx` и `r11`, но все остальные регистры сохраняются и не меняются инструкцией. Например, если у вас в `rcx` хранится какой-то счётчик, то после `syscall` он будет потерян.

## Задание 1. Ассемблер

Пусть в регистре `rax` есть `0` или `1`. Например,

    mov rax, 1

Написать универсальную программу, печатающую на экране значение `rax`.

Т.е. выпводящую на экран символ '0' или символ '1'.

## Задание 2. Ассемблер

Пусть в регистре `rax` хранится значение от `0` до `9`. Например,

    mov rax, 5

Написать универсальную программу, печатающую на экране значение `rax`.

## Задание 3. Ассемблер

Пусть в регистре `rax` хранится значение от `0` до `99`. Например,

    mov rax, 42

Написать универсальную программу, печатающую на экране значение `rax`.

## Задание 4. Ассемблер

Разработать программу, печатающую символ точку `.` 50 раз.

В решении нужно избежать массового дублирования кода

---

Решение:

```
format ELF64 executable
entry main

putchar:
    add rsp, 8
    mov rsi, rsp
    mov rdx, 1
    mov rdi, 1 
    mov rax, 1
    sub rsp, 8
    syscall
    ret 8

main:
    mov rbx, 50
.print_dot:
    cmp rbx, 0
    je exit
    dec rbx
    push '.'
    call putchar
    jmp .print_dot

exit:
    mov rdi, 0          ; exit code 0
    mov rax, 60         ; exit
    syscall             ; jmp to OS kernel
```

## Задание 5. Ассемблер

Пусть дана помеченная область памяти `s` (переменная-строка)

    s db "true", 0

Задача: Написать программу, печатающую строку `s`.

Известно, что в конце строки всегда располагается специальный символ-ноль, т.е. символ с кодом ноль. (Не путать с цифрой `0` имеющий код символа. равный 48.)

Note: Такое соглашение действует в языке C. (В Go это не так, вместо этого Go хранит длину строки, как Pascal)

Решение должно быть универсальным.

---

Решение:

```

```

---

Вопрос: Какой способ хранения строк эффективнее?

* C-strings - строки в стиле C, т.е. с нулём на конце (длина строки не хранится)
* Pascal-strings - строки в стиле Pascal, т.е. нуля в конце нет, но хранится длина строки

### Справка

Поместить адрес первого символа этой строки в регистр можно с помощью инструкции

    mov rsi, s

Прочесть символ строки, адрес которого хранится в `rsi` можно с помощью инструкции

    mov al, [rsi]

Используется `al` - потому что каждый символ в ассемблере FASM занимает один байт, как и в языке C.

Регистр при необходимости можно расширить до `rax` (верхние биты обнуляются):

    movzx rax, al

## Задание 6. Ассемблер

Пусть в регистре `rax` хранится некоторое число, трактуемое как булева следующим образом:

* если число равно `0`, то значение считается логической ложью
* если число не равно `0`, то значение считается логической истиной

(Такое соглашение принято во многих языках программирования, хотя есть и исключения.)

Например,

    mov rax, 0

Написать универсальную программу, печатающую на экране "false" или "true".

## Задание 7. Ассемблер

Пусть в регистре `rax` хранится значение от `-9999` до `9999`. Например,

    mov rax, -1234

Написать универсальную программу, печатающую на экране значение `rax`.

Желательно найти решение без дублирования кода.

## Задание 8. Ассемблер

Пусть в регистре `rax` хранится значение от `-65535` до `65535`. Например,

    mov rax, -1234

Написать универсальную программу, печатающую на экране значение `rax` в шестнадцатиричной системе счисления.

Например, `-1234` в 16-ричной системе счисления равно `-04d2`. Желательно сделать вывод с дополнением ведущими нулями `0`.

Вопрос: В чем преимущество 16-ричной системы счисления? Почему она нередко используется при низкоуровневом программировании?

## Рекомендуемая литература и ресурсы

Charles Petzold. Code. The Hidden Language of Computer Hardware and Software
(Чарльз Петцольд. Код: тайный язык информатики)
